<!DOCTYPE html>
<html>
<p> </p>
<div>
zNear <input id="zNearSlider" type="range"
 min="0.1" max="10" step="0.000000001" value="0.3" />
</div>
<div>
zFar <input id="zFarSlider" type="range"
 min="0" max="10" step="0.0000001" value="10" />
</div>
<div>
radius <input id="radiusSlider" type="range"
 min="-8" max="8" step="0.0000001" value="-2.7" />
</div>
<div>
theta <input id="thetaSlider" type="range"
 min="-90" max="150" step="0.0000001" value="0.43" />
</div>
<div>
phi <input id="phiSlider" type="range"
 min="-90" max="90" step="0.00001" value="-0.5" />
</div>
<div>
fov <input id="fovSlider" type="range"
 min="10" max="300" step="5" value="55" />
</div>
<div>
aspect <input id="aspectSlider" type="range"
 min="0.5" max="2" step="0.1" value="1" />
</div>
<div>
sTheta <input id="spotThetaSlider" type="range"
 min="0.3" max="0.6" step="0.0000005" value="0.45" />
</div>
<div>
Alpha <input id="alphaslider" type="range"
 min="0" max="10" step="0.2" value="0.8" />
</div>
<div>
xSpotlight -50<input id="xSpot" type="range"
 min="-10" max="10" step="0.0000001" value="-0.5" />
 50
</div>
<div>
ySpotlight -50<input id="ySpot" type="range"
 min="-10" max="10" step="0.0000001" value="1" />
 50
</div>
<div>
zSpotlight -50<input id="zSpot" type="range"
 min="-10" max="10" step="0.0000001" value="2" />
 50
</div>


<script id="vertex-shader" type="x-shader/x-vertex">
#version 300 es

in  vec4 aPosition;
in vec4 aNormal;
out vec3 N, L, E;
out vec3 spotE, spotH, spotD, spotL;

uniform mat4 uModelViewMatrix;
uniform mat4 uProjectionMatrix;
uniform vec4 uLightPosition;
uniform mat3 uNormalMatrix;

uniform vec4 spotLightPosition;
uniform vec4 spotLightDirection;


void main()
{
  /*vec3 pos = (uModelViewMatrix * aPosition).xyz;

  //fixed light postion

  vec3 light = uLightPosition.xyz;
  vec3 L = normalize(light - pos);


  vec3 E = normalize(-pos);
  //vec3 H = normalize(L + E);

  vec4 NN = vec4(aNormal,0);

  // Transform vertex normal into eye coordinates

  vec3 N = normalize((uModelViewMatrix*NN).xyz);*/

  vec3 light;
  vec3 pos = (uModelViewMatrix * aPosition).xyz;
  if(uLightPosition.z == 0.0)  L = normalize(uLightPosition.xyz);
  else  L = normalize(uLightPosition).xyz - pos;

  E =  -normalize(pos);
  N = normalize(uNormalMatrix*aNormal.xyz);

  vec3 spotLight=spotLightPosition.xyz-pos;
  spotL=normalize(spotLight);
  spotE=normalize(-pos);
  spotH=normalize(spotL+spotE);
  spotD=spotLightDirection.xyz;



  gl_Position = uProjectionMatrix * uModelViewMatrix *aPosition;
}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">
#version 300 es

precision mediump float;

uniform vec4 comp1_dir, comp2_dir, comp3_dir, comp1_spot, comp2_spot, comp3_spot;
uniform float spotTheta;
uniform float spotAlhpa;

in vec3 N, L;
in vec3 spotE, spotH, spotD, spotL;
out vec4 fColor;
vec4 ci_dir, cs_dir, ci_spot, cs_spot, col_dir, col_spot;


void
main()
{

  ci_dir = comp1_dir + comp2_dir + comp3_dir;
  cs_dir = comp1_dir + comp2_dir;

  ci_spot = comp1_spot + comp2_spot + comp3_spot;
  cs_spot = comp1_spot + comp2_spot;
  // compute the intensity for directional light respect to our cartoon model
  float res_dir = dot(L, N);
  if( res_dir > 0.0 ) {
    if (res_dir >= 0.5) {
      col_dir = ci_dir;
    } else {
      col_dir = cs_dir;
    }
  } else {
    col_dir = cs_dir;
  }

  // do the same for the spotlight

  float res_spot = dot(spotL, N);
  if( res_spot > 0.0 ) {
    if (res_spot >= 0.5) {
      col_spot = ci_dir;
    } else {
      col_spot = cs_dir;
    }
  } else {
    col_spot = cs_dir;
  }


  // check is cone of spotlight cover the fragment
  float cutOff= dot(normalize(spotD), normalize(spotL));
  if(cutOff<spotTheta && cutOff>(-spotTheta))
  {
    float attenuation = pow(cutOff, spotAlhpa);
    fColor = attenuation*col_spot + col_dir;

  } else {
    fColor = col_dir;
  }
  fColor.a = 1.0;

}
</script>

<script type="text/javascript" src="../Common/InitShaders.js"></script>
<script type="text/javascript" src="../Common/MVnew.js"></script>
<script type="text/javascript" src="homework1.js"></script>

<body>

<canvas id="gl-canvas" width="1024" height="1024">
Oops ... your browser doesn't support the HTML5 canvas element
</canvas>
</body>
</html>
